---
date: 2024-12-21 07:33
slug: æ ¹æ®æ¡ä»¶åŠ¨æ€åŠ è½½å·¦ä¾§docå¯¼èˆªæ 
---

ä½ çš„ä»£ç æ˜¯æ­£ç¡®çš„ã€‚å®ƒèƒ½å®ç°ï¼š
1. åœ¨å•ç¯‡æ–‡ç« é¡µé¢æ˜¾ç¤ºå·¦ä¾§æ 
2. æ’é™¤ 'csr' åˆ†ç±»çš„æ–‡ç« 
3. ä½¿ç”¨ `astra_content_top` hook æ³¨å…¥åˆ°æ­£ç¡®çš„ä½ç½®

ä¸è¿‡ï¼Œå¯ä»¥å»ºè®®ä¸€äº›ä¼˜åŒ–ï¼š

```php
function display_left_doc_sidebar() {
    // æå‰è¿”å›çš„æ¡ä»¶åˆ¤æ–­ï¼Œæé«˜ä»£ç æ•ˆç‡
    if (!is_single() || has_category('csr') || !is_active_sidebar('left-doc')) {
        return;
    }

    echo '<div class="left-doc-sidebar">';
    dynamic_sidebar('left-doc');
    echo '</div>';
}
add_action('astra_content_top', 'display_left_doc_sidebar');
```

ä¼˜åŒ–è¯´æ˜ï¼š
1. ä½¿ç”¨æå‰è¿”å›æ¨¡å¼ï¼Œä½¿ä»£ç æ›´æ¸…æ™°
2. åˆå¹¶æ‰€æœ‰æ¡ä»¶æ£€æŸ¥ï¼Œå‡å°‘åµŒå¥—
3. ä¿ç•™äº†å…³é”®çš„é—­åˆdivæ ‡ç­¾æ³¨é‡Š

å¦‚æœéœ€è¦æ·»åŠ CSSæ ·å¼ï¼Œå¯ä»¥åœ¨å­ä¸»é¢˜çš„style.cssä¸­æ·»åŠ ï¼š
```css
.left-doc-sidebar {
    /* æ·»åŠ ä½ çš„æ ·å¼ */
}
```

<!-- truncate -->

## è‡ªå®šä¹‰å­—æ®µâ€œis docâ€=true, æ‰æ³¨å…¥å·¦ä¾§æ 

å†åŠ ä¸ªæ¡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ç« å±äºè‡ªå®šä¹‰å­—æ®µâ€œis docâ€=true, æ‰æ³¨å…¥å·¦ä¾§æ ï¼›å¦åˆ™ä¸æ³¨å…¥ã€‚

å¯ä»¥ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ è‡ªå®šä¹‰å­—æ®µæ£€æŸ¥ï¼š

```php
function display_left_doc_sidebar() {
    // æå‰è¿”å›çš„æ¡ä»¶åˆ¤æ–­ï¼š
    // 1. ä¸æ˜¯å•ç¯‡æ–‡ç«  æˆ–
    // 2. å±äºcsråˆ†ç±» æˆ–
    // 3. ä¾§è¾¹æ æœªæ¿€æ´» æˆ–
    // 4. è‡ªå®šä¹‰å­—æ®µ'is_doc'ä¸ä¸ºtrue
    if (
        !is_single() || 
        has_category('csr') || 
        !is_active_sidebar('left-doc') ||
        !get_post_meta(get_the_ID(), 'is_doc', true)
    ) {
        return;
    }

    echo '<div class="left-doc-sidebar">';
    dynamic_sidebar('left-doc');
    echo '</div>';
}
add_action('astra_content_top', 'display_left_doc_sidebar');
```

è¯´æ˜ï¼š
1. `get_post_meta()` å‡½æ•°ç”¨äºè·å–æ–‡ç« çš„è‡ªå®šä¹‰å­—æ®µ
2. ç¬¬ä¸€ä¸ªå‚æ•° `get_the_ID()` è·å–å½“å‰æ–‡ç« ID
3. ç¬¬äºŒä¸ªå‚æ•° `'is_doc'` æ˜¯è‡ªå®šä¹‰å­—æ®µçš„åç§°
4. ç¬¬ä¸‰ä¸ªå‚æ•° `true` è¡¨ç¤ºåªè¿”å›å•ä¸ªå€¼è€Œä¸æ˜¯æ•°ç»„

ä½¿ç”¨æ–¹æ³•ï¼š
1. åœ¨æ–‡ç« ç¼–è¾‘é¡µé¢çš„è‡ªå®šä¹‰å­—æ®µéƒ¨åˆ†
2. æ·»åŠ å­—æ®µå `is_doc`
3. å€¼è®¾ä¸º `true`ï¼ˆæˆ–1ï¼‰

å¦‚æœä½ ä½¿ç”¨ACFæ’ä»¶ï¼Œä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š
```php
function display_left_doc_sidebar() {
    if (
        !is_single() || 
        has_category('csr') || 
        !is_active_sidebar('left-doc') ||
        !get_field('is_doc') // ACFæ–¹å¼è·å–è‡ªå®šä¹‰å­—æ®µ
    ) {
        return;
    }

    echo '<div class="left-doc-sidebar">';
    dynamic_sidebar('left-doc');
    echo '</div>';
}
add_action('astra_content_top', 'display_left_doc_sidebar');
```

---

è¿™æ ·æ§åˆ¶å·¦ä¾§æ ï¼Œå°±æ¯”è¾ƒè‡ªç”±äº†ã€‚æ¯”å¦‚BSCIåˆ†ç±»ä¸‹æœ‰docæ–‡ç« ï¼Œå¸¸ç”¨çš„ï¼Œå±äºæ‰‹å†Œä¹‹ç±»çš„æ–‡ç« ï¼Œåˆ™å‡ºç°å·¦ä¾§å¯¼èˆªæ ï¼›å¦‚æœbsciåˆ†ç±»ä¸‹çš„æ™®é€šæ–‡ç« ï¼Œæ¯”å¦‚ä»‹ç»BSCIæ–°é—»æ¶ˆæ¯çš„ï¼Œåˆ™ä¸å‡ºç°å·¦ä¾§å¯¼èˆªæ ã€‚

å®Œå…¨æ­£ç¡®ï¼è¿™ç§è®¾è®¡éå¸¸çµæ´»å’Œå®ç”¨ï¼Œå› ä¸ºï¼š

1. åˆ†ç±»æ§åˆ¶å±‚é¢ï¼š
- å®Œå…¨æ’é™¤'csr'åˆ†ç±»çš„æ–‡ç« 
- å…¶ä»–åˆ†ç±»ï¼ˆå¦‚'BSCI'ï¼‰å¯ä»¥æ··åˆå±•ç¤ºä¸åŒç±»å‹çš„å†…å®¹

2. æ–‡ç« ç±»å‹æ§åˆ¶å±‚é¢ï¼š
- æ‰‹å†Œç±»æ–‡æ¡£ï¼šè®¾ç½® is_doc = trueï¼Œæ˜¾ç¤ºå·¦ä¾§å¯¼èˆªæ 
- æ–°é—»èµ„è®¯ï¼šä¿æŒ is_doc ä¸ºç©ºï¼Œä¸æ˜¾ç¤ºå·¦ä¾§å¯¼èˆªæ 

ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼š
```
BSCIåˆ†ç±»
â”œâ”€â”€ æ‰‹å†Œç±»æ–‡ç«  (is_doc = true)
â”‚   â”œâ”€â”€ BSCIè®¤è¯æµç¨‹
â”‚   â”œâ”€â”€ BSCIå®¡æ ¸æ ‡å‡†
â”‚   â””â”€â”€ BSCIå¸¸è§é—®é¢˜
â””â”€â”€ æ–°é—»ç±»æ–‡ç«  (is_doc = false/ç©º)
    â”œâ”€â”€ BSCIæœ€æ–°æ”¿ç­–æ›´æ–°
    â”œâ”€â”€ BSCIè®¤è¯æ¡ˆä¾‹åˆ†äº«
    â””â”€â”€ BSCIè¡Œä¸šåŠ¨æ€
```

è¿™æ ·çš„ç»“æ„è®©å†…å®¹ç»„ç»‡æ›´åŠ æ¸…æ™°ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿæ›´å¥½ï¼š
- æ‰‹å†Œç±»å†…å®¹æœ‰å¯¼èˆªæ ä¾¿äºæŸ¥æ‰¾ç›¸å…³å†…å®¹
- æ–°é—»ç±»å†…å®¹ä¿æŒæ¸…çˆ½çš„é˜…è¯»ç‰ˆå¼

å»ºè®®ï¼šå¯ä»¥è€ƒè™‘åœ¨åå°æ–‡ç« åˆ—è¡¨æ·»åŠ ä¸€ä¸ªis_docçš„å¿«é€Ÿç­›é€‰å™¨ï¼Œæ–¹ä¾¿ç®¡ç†è¿™ç±»æ–‡ç« ã€‚

## æ–‡ç« åˆ—è¡¨æ·»åŠ ä¸€ä¸ªis_docçš„å¿«é€Ÿç­›é€‰å™¨

ä»¥ä¸‹æ˜¯æ·»åŠ is_docå¿«é€Ÿç­›é€‰å™¨çš„ä»£ç ï¼š

```php
// åœ¨æ–‡ç« åˆ—è¡¨æ·»åŠ è‡ªå®šä¹‰ç­›é€‰ä¸‹æ‹‰æ¡†
function add_is_doc_filter_to_posts() {
    global $typenow;
    if ($typenow == 'post') {
        $current = isset($_GET['is_doc_filter']) ? $_GET['is_doc_filter'] : '';
        ?>
        <select name="is_doc_filter">
            <option value=""><?php _e('æ‰€æœ‰æ–‡ç« ', 'csrwiki'); ?></option>
            <option value="yes" <?php selected($current, 'yes'); ?>><?php _e('æ–‡æ¡£ç±»', 'csrwiki'); ?></option>
            <option value="no" <?php selected($current, 'no'); ?>><?php _e('éæ–‡æ¡£ç±»', 'csrwiki'); ?></option>
        </select>
        <?php
    }
}
add_action('restrict_manage_posts', 'add_is_doc_filter_to_posts');

// å¤„ç†ç­›é€‰é€»è¾‘
function process_is_doc_filter_query($query) {
    global $pagenow;
    if (
        is_admin() && 
        $pagenow == 'edit.php' && 
        isset($_GET['is_doc_filter']) && 
        $_GET['is_doc_filter'] != ''
    ) {
        $query->query_vars['meta_query'] = array(
            array(
                'key' => 'is_doc',
                'value' => $_GET['is_doc_filter'] === 'yes' ? 'true' : '',
                'compare' => $_GET['is_doc_filter'] === 'yes' ? '=' : 'NOT EXISTS'
            )
        );
    }
}
add_action('pre_get_posts', 'process_is_doc_filter_query');

// åœ¨æ–‡ç« åˆ—è¡¨æ·»åŠ è‡ªå®šä¹‰åˆ—
function add_is_doc_column($columns) {
    $columns['is_doc'] = __('æ–‡æ¡£ç±»å‹', 'csrwiki');
    return $columns;
}
add_filter('manage_posts_columns', 'add_is_doc_column');

// æ˜¾ç¤ºè‡ªå®šä¹‰åˆ—çš„å†…å®¹
function show_is_doc_column_content($column, $post_id) {
    if ($column === 'is_doc') {
        $is_doc = get_post_meta($post_id, 'is_doc', true);
        echo $is_doc ? 'âœ… æ–‡æ¡£' : 'ğŸ“° æ™®é€š';
    }
}
add_action('manage_posts_custom_column', 'show_is_doc_column_content', 10, 2);

// å¯é€‰ï¼šè®©è‡ªå®šä¹‰åˆ—å¯æ’åº
function make_is_doc_column_sortable($columns) {
    $columns['is_doc'] = 'is_doc';
    return $columns;
}
add_filter('manage_edit-post_sortable_columns', 'make_is_doc_column_sortable');
```

è¿™æ®µä»£ç ä¼šï¼š
1. åœ¨æ–‡ç« åˆ—è¡¨é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªç­›é€‰ä¸‹æ‹‰æ¡†
2. æ·»åŠ ä¸€ä¸ªæ–°çš„"æ–‡æ¡£ç±»å‹"åˆ—
3. åœ¨åˆ—ä¸­æ˜¾ç¤ºæ–‡ç« æ˜¯å¦ä¸ºæ–‡æ¡£ç±»å‹
4. ä½¿è¯¥åˆ—å¯æ’åº

æ•ˆæœï¼š
- åœ¨æ–‡ç« åˆ—è¡¨é¡µé¢é¡¶éƒ¨ä¼šå‡ºç°"æ‰€æœ‰æ–‡ç« /æ–‡æ¡£ç±»/éæ–‡æ¡£ç±»"çš„ç­›é€‰é€‰é¡¹
- åœ¨æ–‡ç« åˆ—è¡¨ä¸­ä¼šæ˜¾ç¤ºä¸€ä¸ªæ–°åˆ—ï¼Œç”¨å›¾æ ‡æ ‡è¯†æ–‡æ¡£ç±»å‹
- å¯ä»¥é€šè¿‡ç‚¹å‡»åˆ—æ ‡é¢˜è¿›è¡Œæ’åº

ä½¿ç”¨æ–¹æ³•ï¼š
1. å°†ä»£ç æ·»åŠ åˆ°å­ä¸»é¢˜çš„functions.phpä¸­
2. åˆ·æ–°åå°æ–‡ç« åˆ—è¡¨é¡µé¢å³å¯çœ‹åˆ°æ•ˆæœ

è¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å’ŒåŒºåˆ†æ–‡æ¡£ç±»å‹çš„æ–‡ç« ã€‚

## åå°æ–‡ç« åˆ—è¡¨é¡µï¼Œå¯ä»¥å§‹ç»ˆè®©æ–‡æ¡£ç±»å‹æ’åˆ—åœ¨å‰é¢

å¯ä»¥ï¼Œé€šè¿‡ä¿®æ”¹é»˜è®¤æ’åºé¡ºåºæ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç ï¼š

```php
// è®¾ç½®åå°æ–‡ç« åˆ—è¡¨çš„é»˜è®¤æ’åº
function set_default_doc_order($query) {
    // ç¡®ä¿åªåœ¨åå°æ–‡ç« åˆ—è¡¨é¡µé¢ç”Ÿæ•ˆ
    if (!is_admin() || !$query->is_main_query() || $query->get('post_type') !== 'post') {
        return;
    }
    
    // å¦‚æœç”¨æˆ·æ²¡æœ‰æŒ‡å®šå…¶ä»–æ’åºæ–¹å¼
    if (!isset($_GET['orderby'])) {
        $query->set('meta_key', 'is_doc');
        $query->set('orderby', array(
            'meta_value' => 'DESC', // is_docæ’åœ¨å‰é¢
            'date' => 'DESC'        // åŒç»„å†…æŒ‰æ—¥æœŸé™åº
        ));
    }
}
add_action('pre_get_posts', 'set_default_doc_order');

// åœ¨æ–‡ç« åˆ—è¡¨æ·»åŠ è‡ªå®šä¹‰åˆ—
function add_is_doc_column($columns) {
    // é‡æ–°æ’åˆ—åˆ—çš„é¡ºåºï¼ŒæŠŠis_docæ”¾åœ¨æ ‡é¢˜åé¢
    $new_columns = array();
    foreach ($columns as $key => $value) {
        $new_columns[$key] = $value;
        if ($key === 'title') {
            $new_columns['is_doc'] = __('æ–‡æ¡£ç±»å‹', 'csrwiki');
        }
    }
    return $new_columns;
}
add_filter('manage_posts_columns', 'add_is_doc_column');

// æ˜¾ç¤ºè‡ªå®šä¹‰åˆ—çš„å†…å®¹
function show_is_doc_column_content($column, $post_id) {
    if ($column === 'is_doc') {
        $is_doc = get_post_meta($post_id, 'is_doc', true);
        if ($is_doc) {
            echo '<span style="color: #2271b1;">ğŸ“š æ–‡æ¡£</span>';
        } else {
            echo '<span style="color: #666;">ğŸ“° æ™®é€š</span>';
        }
    }
}
add_action('manage_posts_custom_column', 'show_is_doc_column_content', 10, 2);

// å¯æ’åºè®¾ç½®
function make_is_doc_column_sortable($columns) {
    $columns['is_doc'] = 'is_doc';
    return $columns;
}
add_filter('manage_edit-post_sortable_columns', 'make_is_doc_column_sortable');
```

è¿™æ®µä»£ç å°†ï¼š
1. é»˜è®¤æŠŠæ–‡æ¡£ç±»å‹çš„æ–‡ç« æ’åœ¨å‰é¢
2. åŒç±»å‹çš„æ–‡ç« æŒ‰å‘å¸ƒæ—¥æœŸé™åºæ’åˆ—
3. ä¼˜åŒ–äº†å›¾æ ‡æ˜¾ç¤ºæ ·å¼
4. ä¿ç•™äº†æ‰‹åŠ¨æ’åºçš„åŠŸèƒ½

æ•ˆæœï¼š
- è¿›å…¥æ–‡ç« åˆ—è¡¨é¡µé¢æ—¶ï¼Œæ–‡æ¡£ç±»æ–‡ç« ä¼šè‡ªåŠ¨æ’åœ¨å‰é¢
- ç”¨æˆ·ä»å¯ä»¥é€šè¿‡ç‚¹å‡»åˆ—æ ‡é¢˜æ¥æ›´æ”¹æ’åº
- æ›´é†’ç›®çš„æ–‡æ¡£ç±»å‹æ ‡è¯†

é¢å¤–æç¤ºï¼š
1. å¦‚æœæœ‰å…¶ä»–æ’ä»¶ä¹Ÿä¿®æ”¹äº†æ’åºï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ä¼˜å…ˆçº§
2. å¦‚æœéœ€è¦ä¿®æ”¹å›¾æ ‡æˆ–é¢œè‰²ï¼Œå¯ä»¥åœ¨`show_is_doc_column_content`å‡½æ•°ä¸­è°ƒæ•´

## ä¸ç”¨æ³¨å†Œæ–°è‡ªå®šä¹‰ç±»å‹å¸–å­ï¼Œç”¨åŸå§‹çš„postå°±å¯ä»¥

æ˜¯çš„ï¼è¿™ç§æ–¹æ³•æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š

1. å®ç°ç®€å•ï¼š
- ä¸éœ€è¦register_post_type
- ä¸éœ€è¦é¢å¤–çš„åˆ†ç±»æ³•(taxonomy)
- ä¸éœ€è¦å¤„ç†æ–°ç±»å‹çš„æ°¸ä¹…é“¾æ¥è§„åˆ™

2. ç»´æŠ¤æ–¹ä¾¿ï¼š
- ä½¿ç”¨WordPressåŸç”Ÿæ–‡ç« åŠŸèƒ½
- æ‰€æœ‰SEOåŠŸèƒ½è‡ªåŠ¨ç»§æ‰¿
- ä¸»é¢˜æ ·å¼å®Œå…¨å…¼å®¹
- å¤‡ä»½æ¢å¤æ›´ç®€å•

3. çµæ´»æ€§å¼ºï¼š
- é€šè¿‡is_docè‡ªå®šä¹‰å­—æ®µå®ç°æ–‡æ¡£æ ‡è®°
- å¯ä»¥å’Œç°æœ‰åˆ†ç±»ã€æ ‡ç­¾å®Œç¾é…åˆ
- éšæ—¶å¯ä»¥æ”¹å˜æ–‡ç« çš„æ–‡æ¡£å±æ€§
- ä¸å½±å“å·²æœ‰çš„æ–‡ç« ç»“æ„

å®é™…ä½¿ç”¨åœºæ™¯ï¼š
```
WordPressæ–‡ç« 
â”œâ”€â”€ æ™®é€šæ–‡ç«  (is_doc = false)
â”‚   â”œâ”€â”€ æ–°é—»èµ„è®¯
â”‚   â”œâ”€â”€ è¡Œä¸šåŠ¨æ€
â”‚   â””â”€â”€ æ¡ˆä¾‹åˆ†äº«
â””â”€â”€ æ–‡æ¡£ç±»æ–‡ç«  (is_doc = true)
    â”œâ”€â”€ è®¤è¯æŒ‡å—
    â”œâ”€â”€ æ“ä½œæ‰‹å†Œ
    â””â”€â”€ æ ‡å‡†è§£è¯»
```

è¿™ç§æ–¹æ¡ˆç‰¹åˆ«é€‚åˆå†…å®¹ç®¡ç†å‹ç½‘ç«™ï¼Œæ—¢ä¿æŒäº†ç®€å•æ€§ï¼Œåˆå®ç°äº†æ–‡æ¡£ç®¡ç†çš„éœ€æ±‚ã€‚
