"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7640],{26922:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>o,default:()=>l,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var r=t(68755),s=t(74848),i=t(28453);const a={date:"2024-12-18 19:58",slug:"WordPress\u5236\u4f5c\u7528\u6237\u4e2a\u4eba\u6536\u85cf\u4e2d\u5fc3"},o=void 0,d={authorsImageUrls:[]},c=[{value:"1. \u5728functions.php\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u4ee3\u7801:",id:"1-\u5728functionsphp\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u4ee3\u7801",level:3},{value:"2. \u521b\u5efa\u4e2a\u4eba\u4e2d\u5fc3\u9875\u9762\u6a21\u677f",id:"2-\u521b\u5efa\u4e2a\u4eba\u4e2d\u5fc3\u9875\u9762\u6a21\u677f",level:3},{value:"3. \u5728style.css\u4e2d\u6dfb\u52a0\u6837\u5f0f:",id:"3-\u5728stylecss\u4e2d\u6dfb\u52a0\u6837\u5f0f",level:3},{value:"4. \u521b\u5efacustom.js\u6587\u4ef6:",id:"4-\u521b\u5efacustomjs\u6587\u4ef6",level:3},{value:"\u4f7f\u7528\u6b65\u9aa4:",id:"\u4f7f\u7528\u6b65\u9aa4",level:3},{value:"\u529f\u80fd\u8bf4\u660e:",id:"\u529f\u80fd\u8bf4\u660e",level:3}];function p(n){const e={code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.p,{children:"\u6574\u7406\u5b8c\u6574\u7684\u4e2a\u4eba\u6536\u85cf\u4e2d\u5fc3\u5b9e\u73b0\u6d41\u7a0b\u548c\u4ee3\u7801\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u5728functionsphp\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u4ee3\u7801",children:"1. \u5728functions.php\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u4ee3\u7801:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:"// 1. \u6ce8\u518c\u5fc5\u8981\u7684\u811a\u672c\u548c\u6837\u5f0f\nfunction enqueue_favorite_scripts() {\n    wp_enqueue_script('jquery');\n    wp_enqueue_script('favorite-script', get_stylesheet_directory_uri() . '/custom.js', array('jquery'), '1.0', true);\n    wp_localize_script('favorite-script', 'ajax_object', array(\n        'ajax_url' => admin_url('admin-ajax.php')\n    ));\n}\nadd_action('wp_enqueue_scripts', 'enqueue_favorite_scripts');\n\n// 2. \u6dfb\u52a0\u6536\u85cf\u6309\u94ae\u5230\u6587\u7ae0\nfunction add_favorite_button() {\n    if (is_single() && is_user_logged_in()) {\n        $post_id = get_the_ID();\n        $user_id = get_current_user_id();\n        $favorites = get_user_meta($user_id, 'user_favorites', true);\n        \n        if (!is_array($favorites)) {\n            $favorites = array();\n        }\n        \n        $is_favorited = in_array($post_id, $favorites);\n        $button_text = $is_favorited ? '\u53d6\u6d88\u6536\u85cf' : '\u6536\u85cf\u6587\u7ae0';\n        $button_class = $is_favorited ? 'favorited' : '';\n        \n        echo '<button class=\"favorite-button ' . $button_class . '\" data-post-id=\"' . $post_id . '\">' . $button_text . '</button>';\n    }\n}\nadd_action('astra_entry_content_after', 'add_favorite_button');\n\n// 3. \u5904\u7406AJAX\u6536\u85cf\u8bf7\u6c42\nfunction handle_favorite_action() {\n    if (!is_user_logged_in()) {\n        wp_send_json_error('\u8bf7\u5148\u767b\u5f55');\n    }\n    \n    $post_id = isset($_POST['post_id']) ? intval($_POST['post_id']) : 0;\n    $user_id = get_current_user_id();\n    $favorites = get_user_meta($user_id, 'user_favorites', true);\n    \n    if (!is_array($favorites)) {\n        $favorites = array();\n    }\n    \n    if (in_array($post_id, $favorites)) {\n        $favorites = array_diff($favorites, array($post_id));\n        $action = 'removed';\n    } else {\n        $favorites[] = $post_id;\n        $action = 'added';\n    }\n    \n    update_user_meta($user_id, 'user_favorites', $favorites);\n    \n    wp_send_json_success(array(\n        'action' => $action,\n        'message' => $action === 'added' ? '\u6536\u85cf\u6210\u529f' : '\u5df2\u53d6\u6d88\u6536\u85cf'\n    ));\n}\nadd_action('wp_ajax_handle_favorite', 'handle_favorite_action');\n"})}),"\n",(0,s.jsx)(e.h3,{id:"2-\u521b\u5efa\u4e2a\u4eba\u4e2d\u5fc3\u9875\u9762\u6a21\u677f",children:"2. \u521b\u5efa\u4e2a\u4eba\u4e2d\u5fc3\u9875\u9762\u6a21\u677f"}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u4e3b\u9898\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6 ",(0,s.jsx)(e.code,{children:"page-user-center.php"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:'<?php\n/*\nTemplate Name: \u7528\u6237\u4e2d\u5fc3\n*/\n\nif (!is_user_logged_in()) {\n    wp_redirect(wp_login_url(get_permalink()));\n    exit;\n}\n\nget_header();\n?>\n\n<div class="ast-container">\n    <div id="primary" class="content-area primary">\n        <main id="main" class="site-main">\n            <article class="user-center-container">\n                <?php\n                $user = wp_get_current_user();\n                $favorites = get_user_meta($user->ID, \'user_favorites\', true);\n                ?>\n                \n                <div class="user-info">\n                    <h2>\u6b22\u8fce, <?php echo esc_html($user->display_name); ?></h2>\n                    <?php echo get_avatar($user->ID, 96); ?>\n                </div>\n                \n                <div class="favorite-posts">\n                    <h3>\u6211\u7684\u6536\u85cf</h3>\n                    <?php\n                    if (!empty($favorites) && is_array($favorites)) {\n                        $args = array(\n                            \'post__in\' => $favorites,\n                            \'post_type\' => \'post\',\n                            \'posts_per_page\' => -1\n                        );\n                        \n                        $favorite_query = new WP_Query($args);\n                        \n                        if ($favorite_query->have_posts()) {\n                            echo \'<div class="favorite-list">\';\n                            while ($favorite_query->have_posts()) {\n                                $favorite_query->the_post();\n                                ?>\n                                <div class="favorite-post-item">\n                                    <a href="<?php the_permalink(); ?>">\n                                        <?php if (has_post_thumbnail()): ?>\n                                            <?php the_post_thumbnail(\'thumbnail\'); ?>\n                                        <?php endif; ?>\n                                        <h4><?php the_title(); ?></h4>\n                                    </a>\n                                    <button class="remove-favorite" data-post-id="<?php echo get_the_ID(); ?>">\u5220\u9664\u6536\u85cf</button>\n                                </div>\n                                <?php\n                            }\n                            echo \'</div>\';\n                            wp_reset_postdata();\n                        }\n                    } else {\n                        echo \'<p class="no-favorites">\u6682\u65e0\u6536\u85cf\u6587\u7ae0</p>\';\n                    }\n                    ?>\n                </div>\n            </article>\n        </main>\n    </div>\n</div>\n\n<?php get_footer(); ?>\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u5728stylecss\u4e2d\u6dfb\u52a0\u6837\u5f0f",children:"3. \u5728style.css\u4e2d\u6dfb\u52a0\u6837\u5f0f:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-css",children:"/* \u6536\u85cf\u6309\u94ae\u6837\u5f0f */\n.favorite-button {\n    padding: 8px 15px;\n    background: #f0f0f0;\n    border: 1px solid #ddd;\n    border-radius: 3px;\n    cursor: pointer;\n    margin: 15px 0;\n    transition: all 0.3s ease;\n}\n\n.favorite-button.favorited {\n    background: #ff6b6b;\n    color: white;\n    border-color: #ff6b6b;\n}\n\n/* \u7528\u6237\u4e2d\u5fc3\u6837\u5f0f */\n.user-center-container {\n    max-width: 800px;\n    margin: 0 auto;\n    padding: 20px;\n}\n\n.user-info {\n    text-align: center;\n    margin-bottom: 30px;\n    padding: 20px;\n    background: #f9f9f9;\n    border-radius: 8px;\n}\n\n.user-info img {\n    border-radius: 50%;\n    margin: 10px 0;\n}\n\n.favorite-post-item {\n    display: flex;\n    align-items: center;\n    padding: 15px;\n    border-bottom: 1px solid #eee;\n    transition: background 0.3s ease;\n}\n\n.favorite-post-item:hover {\n    background: #f9f9f9;\n}\n\n.favorite-post-item img {\n    width: 100px;\n    height: auto;\n    margin-right: 15px;\n    border-radius: 4px;\n}\n\n.favorite-post-item h4 {\n    margin: 0;\n    flex: 1;\n}\n\n.remove-favorite {\n    padding: 5px 10px;\n    background: #ff6b6b;\n    color: white;\n    border: none;\n    border-radius: 3px;\n    cursor: pointer;\n    transition: background 0.3s ease;\n}\n\n.remove-favorite:hover {\n    background: #ff5252;\n}\n\n.no-favorites {\n    text-align: center;\n    padding: 30px;\n    background: #f9f9f9;\n    border-radius: 8px;\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"4-\u521b\u5efacustomjs\u6587\u4ef6",children:"4. \u521b\u5efacustom.js\u6587\u4ef6:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"jQuery(document).ready(function($) {\n    // \u6536\u85cf\u6309\u94ae\u70b9\u51fb\u4e8b\u4ef6\n    $('.favorite-button').click(function() {\n        var button = $(this);\n        var postId = button.data('post-id');\n        \n        $.ajax({\n            url: ajax_object.ajax_url,\n            type: 'POST',\n            data: {\n                action: 'handle_favorite',\n                post_id: postId\n            },\n            success: function(response) {\n                if (response.success) {\n                    if (response.data.action === 'added') {\n                        button.addClass('favorited');\n                        button.text('\u53d6\u6d88\u6536\u85cf');\n                    } else {\n                        button.removeClass('favorited');\n                        button.text('\u6536\u85cf\u6587\u7ae0');\n                    }\n                }\n            }\n        });\n    });\n\n    // \u5220\u9664\u6536\u85cf\u6309\u94ae\u70b9\u51fb\u4e8b\u4ef6\n    $('.remove-favorite').click(function() {\n        var button = $(this);\n        var postId = button.data('post-id');\n        var postItem = button.closest('.favorite-post-item');\n        \n        $.ajax({\n            url: ajax_object.ajax_url,\n            type: 'POST',\n            data: {\n                action: 'handle_favorite',\n                post_id: postId\n            },\n            success: function(response) {\n                if (response.success) {\n                    postItem.fadeOut(300, function() {\n                        $(this).remove();\n                        if ($('.favorite-post-item').length === 0) {\n                            $('.favorite-list').html('<p class=\"no-favorites\">\u6682\u65e0\u6536\u85cf\u6587\u7ae0</p>');\n                        }\n                    });\n                }\n            }\n        });\n    });\n});\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528\u6b65\u9aa4",children:"\u4f7f\u7528\u6b65\u9aa4:"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u5c06\u6240\u6709\u4ee3\u7801\u6dfb\u52a0\u5230\u76f8\u5e94\u6587\u4ef6\u4e2d"}),"\n",(0,s.jsx)(e.li,{children:'\u5728WordPress\u540e\u53f0\u521b\u5efa\u65b0\u9875\u9762\uff0c\u9009\u62e9"\u7528\u6237\u4e2d\u5fc3"\u6a21\u677f'}),"\n",(0,s.jsx)(e.li,{children:"\u53d1\u5e03\u9875\u9762\uff0c\u8bb0\u5f55\u9875\u9762\u94fe\u63a5"}),"\n",(0,s.jsx)(e.li,{children:"\u53ef\u4ee5\u5728\u83dc\u5355\u4e2d\u6dfb\u52a0\u7528\u6237\u4e2d\u5fc3\u94fe\u63a5"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u529f\u80fd\u8bf4\u660e",children:"\u529f\u80fd\u8bf4\u660e:"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u767b\u5f55\u7528\u6237\u53ef\u4ee5\u5728\u6587\u7ae0\u9875\u9762\u6536\u85cf/\u53d6\u6d88\u6536\u85cf\u6587\u7ae0"}),"\n",(0,s.jsx)(e.li,{children:"\u7528\u6237\u53ef\u4ee5\u5728\u4e2a\u4eba\u4e2d\u5fc3\u67e5\u770b\u6240\u6709\u6536\u85cf\u7684\u6587\u7ae0"}),"\n",(0,s.jsx)(e.li,{children:"\u53ef\u4ee5\u76f4\u63a5\u5728\u4e2a\u4eba\u4e2d\u5fc3\u5220\u9664\u6536\u85cf"}),"\n",(0,s.jsx)(e.li,{children:"\u672a\u767b\u5f55\u7528\u6237\u4f1a\u81ea\u52a8\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762"}),"\n",(0,s.jsx)(e.li,{children:"\u54cd\u5e94\u5f0f\u8bbe\u8ba1\uff0c\u9002\u914d\u79fb\u52a8\u8bbe\u5907"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u9700\u6dfb\u52a0\u5176\u4ed6\u529f\u80fd\u6216\u4fee\u6539\uff0c\u8bf7\u544a\u8bc9\u6211\u3002"})]})}function l(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(p,{...n})}):p(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>a,x:()=>o});var r=t(96540);const s={},i=r.createContext(s);function a(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:a(n.components),r.createElement(i.Provider,{value:e},n.children)}},68755:n=>{n.exports=JSON.parse('{"permalink":"/blog/WordPress\u5236\u4f5c\u7528\u6237\u4e2a\u4eba\u6536\u85cf\u4e2d\u5fc3","editUrl":"https://github.com/frankelinli/frankelinli.github.io/edit/main/blog/2024/12-18-WordPress\u5236\u4f5c\u7528\u6237\u4e2a\u4eba\u6536\u85cf\u4e2d\u5fc3.md","source":"@site/blog/2024/12-18-WordPress\u5236\u4f5c\u7528\u6237\u4e2a\u4eba\u6536\u85cf\u4e2d\u5fc3.md","title":"WordPress\u5236\u4f5c\u7528\u6237\u4e2a\u4eba\u6536\u85cf\u4e2d\u5fc3","description":"\u6574\u7406\u5b8c\u6574\u7684\u4e2a\u4eba\u6536\u85cf\u4e2d\u5fc3\u5b9e\u73b0\u6d41\u7a0b\u548c\u4ee3\u7801\u3002","date":"2024-12-18T19:58:00.000Z","tags":[],"readingTime":3.65,"hasTruncateMarker":true,"authors":[],"frontMatter":{"date":"2024-12-18 19:58","slug":"WordPress\u5236\u4f5c\u7528\u6237\u4e2a\u4eba\u6536\u85cf\u4e2d\u5fc3"},"unlisted":false,"lastUpdatedAt":1734530847000,"prevItem":{"title":"\u53f3\u4fa7\u8fb9\u680fblock 43\u7c98\u6027\u7684\u8bbe\u7f6e","permalink":"/blog/\u53f3\u4fa7\u8fb9\u680fblock 43\u7c98\u6027\u7684\u8bbe\u7f6e"},"nextItem":{"title":"WordPress\u4ee3\u7801\u5757\u589e\u52a0\u4ee3\u7801\u9ad8\u4eae\u548c\u590d\u5236\u529f\u80fd","permalink":"/blog/WordPress\u4ee3\u7801\u5757\u589e\u52a0\u4ee3\u7801\u9ad8\u4eae\u548c\u590d\u5236\u529f\u80fd"}}')}}]);